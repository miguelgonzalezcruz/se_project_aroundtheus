(()=>{"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const t=class{constructor(t,s){e(this,"_hasInvalidInput",(e=>e.some((e=>!e.validity.valid)))),e(this,"_disableSubmitButton",(()=>{this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0})),e(this,"_enableSubmitButton",(()=>{this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1})),e(this,"_toggleButtonState",(e=>{this._hasInvalidInput(e)?this._disableSubmitButton():this._enableSubmitButton()})),this._formElement=s,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}_hideInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputList)}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._disableSubmitButton(),this._inputList.forEach((e=>{this._hideInputError(e)}))}},s={formSelector:"popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",cardSection:"elements",cardTemplate:"#card-template",cardFormPopupSelector:".create-popup",avatarFormPopupSelector:"avatar-popup"},n=class{constructor(e){this._popup=document.querySelector(e),this._pressEsc=this._pressEsc.bind(this)}openPopupWindow(){this._popup.classList.add("popup_is-opened"),document.addEventListener("keydown",this._pressEsc)}closePopupWindow(){this._popup.classList.remove("popup_is-opened"),document.removeEventListener("keydown",this._pressEsc)}_pressEsc(e){"Escape"===e.key&&this.closePopupWindow()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{e.target.classList.contains("popup")&&this.closePopupWindow()})),this._popup.querySelector(".popup__close").addEventListener("click",(()=>this.closePopupWindow()))}},i=class extends n{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._handleFormSubmit=s,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__button"),this._normalButtonText=this._submitButton.textContent}_getInputValues(){return this._data={},this._inputList.forEach((e=>{this._data[e.name]=e.value})),this._data}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}closePopupWindow(){super.closePopupWindow(),this._form.reset()}loadingText(e){this._submitButton.textContent=!0===e?"Loading ...":this._normalButtonText}};let r=null;const o=document.querySelector(".profile__info-edit"),a=document.querySelector(".edit-popup"),u=document.querySelector(".popup__content-form"),l=document.querySelector(".popup__avatar-form"),h=document.querySelector(".profile__avatar-edit"),p=document.querySelector(".avatar-popup"),_=document.querySelector(".profile__add"),c=document.querySelector(".create-popup"),d=u.querySelector(".popup__input_content_name"),m=u.querySelector(".popup__input_content_role"),v=l.querySelector(".popup__input_avatar_link"),E=new class extends n{constructor(e){super(e);const t=document.querySelector(".popup__preview-image"),s=document.querySelector(".popup__preview-caption");this.previewImageElement=t,this.previewImageCaption=s}_addImagePreview(){this.previewImageElement.src=this.link,this.previewImageElement.alt=this.name,this.previewImageCaption.textContent=this.name}openPopupWindow(e){this.name=e.name,this.link=e.link,this._addImagePreview(),super.openPopupWindow()}}("#preview-popup");E.setEventListeners();const b=new class extends n{constructor(e){super(e),this._handleFormSubmit,this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._form.querySelector(".popup__button"),this._normalButtonText=this._submitButton.textContent}confirmDelete(e){this._handleFormSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()}))}loadingText(e){this._submitButton.textContent=!0===e?"Deleting ...":this._normalButtonText}}("#delete-popup");b.setEventListeners();const I=new class{constructor(e){let{userNameInput:t,userJobInput:s,userAvatarInput:n}=e;this._userNameElement=document.querySelector(t),this._userJobElement=document.querySelector(s),this._userAvatarElement=document.querySelector(n)}setUserInfo(e){let{userNewNameInput:t,userNewJobInput:s,userNewAvatarInput:n}=e;this._userNameElement.textContent=t,this._userJobElement.textContent=s,this._userAvatarElement.src=n}getUserInfo(){return{userNameInput:this._userNameElement.textContent,userJobInput:this._userJobElement.textContent,userAvatarInput:this._userAvatarElement.src}}}({userNameInput:".profile__info-title",userJobInput:".profile__info-subtitle",userAvatarInput:".profile__avatar-image"}),w=new class{constructor(e){var t,s;s=e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)),(t="_checkResponse")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._url=e.url,this._headers=e.headers}getUserInfo(){return fetch(this._url+"/users/me",{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(this._url+"/cards",{headers:this._headers}).then(this._checkResponse)}editUserInfo(e){return fetch(this._url+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}editUserPicture(e){return fetch(this._url+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._checkResponse)}postNewCard(e){return fetch(this._url+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}addNewLikes(e){return fetch(this._url+"/cards/likes/"+e,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeNewLikes(e){return fetch(this._url+"/cards/likes/"+e,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch(this._url+"/cards/"+e,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({url:" https://around.nomoreparties.co/v1/group-12",headers:{authorization:"f0f5b035-9e61-4cc2-926f-83804fb546a7","Content-Type":"application/json"}});Promise.all([w.getUserInfo(),w.getInitialCards()]).then((e=>{let[t,s]=e;r=t._id,console.log(t),I.setUserInfo({userNewNameInput:t.name,userNewJobInput:t.about,userNewAvatarInput:t.avatar}),f.setupItems(s),f.renderItems()})).catch((e=>{console.log(e)}));const f=new class{constructor(e,t){let{items:s,renderer:n}=e;this._itemsArray=s,this._renderer=n,this._element=document.querySelector(t)}addItem(e){this._element.prepend(e)}clear(){this._element.innerHTML=""}renderItems(){this.clear(),this._itemsArray.forEach((e=>{this._renderer(e)}))}setupItems(e){this._itemsArray=e}}({items:[],renderer:e=>{S(f,e,E,b)}},".elements");function S(e,t,s,n){t._userId=r;const i=new class{constructor(e,t,s,n,i){this._createdAt=e.createdAt,this._likes=e.likes,this._link=e.link,this._name=e.name,this._id=e._id,this._userId=e._userId,this._ownerId=e.owner._id,this._cardTemplate=document.querySelector(t).content.querySelector("#element"),this._handleImagePreview=s,this._handleLikeButton=n,this._handleDeleteButton=i,this._element,this._previewImage,this._totalLikes}_showlikes(){this._totalLikes.textContent=this._likes.length,this.isLiked()?this._likeButton.classList.add("active__heart"):this._likeButton.classList.remove("active__heart")}_getCardElement(){return this._cardTemplate.cloneNode(!0)}createCardElement(){return this._element=this._getCardElement(),this._setTextAndImage(),this._setEventListeners(),this._showlikes(),this._hideDelete(),this._element}_setTextAndImage(){this._deleteButton=this._element.querySelector(".element__delete-icon"),this._likeButton=this._element.querySelector(".element__content-icon"),this._previewImage=this._element.querySelector(".element__image"),this._previewImage.src=this._link,this._previewImage.alt=this._name,this._element.querySelector(".element__content-title").textContent=this._name,this._totalLikes=this._element.querySelector(".element__content-number")}_getCardElement(){return this._cardTemplate.cloneNode(!0)}_setEventListeners(){this._likeButton.addEventListener("click",(()=>this._handleLikeButton())),this._deleteButton.addEventListener("click",(()=>this._handleDeleteButton())),this._previewImage.addEventListener("click",(()=>this._handleImagePreview()))}handleDelete(){this._element.remove()}setLikes(e){this._likes=e,this._showlikes()}isLiked(){return Boolean(this._likes.find((e=>e._id===this._userId)))}_hideDelete(){this._userId!==this._ownerId&&this._deleteButton.remove()}}(t,"#card-template",(()=>{s.openPopupWindow(t)}),(()=>{i.isLiked()?w.removeNewLikes(t._id).then((e=>{i.setLikes(e.likes)})).catch((e=>{console.log(e)})):w.addNewLikes(t._id).then((e=>{i.setLikes(e.likes)})).catch((e=>{console.log(e)}))}),(()=>{n.confirmDelete((()=>{n.loadingText(!0),w.deleteCard(t._id).then((()=>{i.handleDelete(),n.closePopupWindow()})).catch((e=>{console.log(e)})).finally((()=>n.loadingText(!1)))})),n.openPopupWindow()})),o=i.createCardElement();e.addItem(o)}const L=new i({popupSelector:"#create-popup",handleFormSubmit:e=>{L.loadingText(!0),w.postNewCard(e).then((e=>{S(f,e,E,b),L.closePopupWindow()})).catch((e=>{console.log(e)})).finally((()=>L.loadingText(!1)))}});L.setEventListeners();const g=new i({popupSelector:".edit-popup",handleFormSubmit:e=>{g.loadingText(!0),w.editUserInfo(e).then((e=>{I.setUserInfo({userNewNameInput:e.name,userNewJobInput:e.about,userNewAvatarInput:e.avatar}),g.closePopupWindow()})).catch((e=>{console.log(e)})).finally((()=>g.loadingText(!1)))}});g.setEventListeners();const k=new i({popupSelector:".avatar-popup",handleFormSubmit:e=>{k.loadingText(!0),w.editUserPicture(e).then((e=>{I.setUserInfo({userNewNameInput:e.name,userNewJobInput:e.about,userNewAvatarInput:e.avatar}),k.closePopupWindow()})).catch((e=>{console.log(e)})).finally((()=>k.loadingText(!1)))}});k.setEventListeners();const y=new t(s,a),C=new t(s,c),B=new t(s,p);y.enableValidation(),C.enableValidation(),B.enableValidation(),_.addEventListener("click",(()=>{L.openPopupWindow(),C.resetValidation()})),o.addEventListener("click",(()=>{const e=I.getUserInfo();d.value=e.userNameInput,m.value=e.userJobInput,g.openPopupWindow(),y.resetValidation()})),h.addEventListener("click",(()=>{const e=I.getUserInfo();v.value=e.userAvatarInput,k.openPopupWindow(),B.resetValidation()}))})();
//# sourceMappingURL=main.js.map